/*!
    --------------------------------
    PXU Photoset Extended
    --------------------------------
    + https://github.com/PixelUnion/Extended-Tumblr-Photoset
    + Version 1.3.0
    + Copyright 2012 Pixel Union
    + Licensed under the MIT license
*/
(function(a){a.fn.pxuPhotoset=function(b,e){var d={highRes:true,rounded:"corners",borderRadius:"5px",exif:true,captions:true,gutter:"10px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".photo"};var c=a.extend(d,b);return this.each(function(){var f=a(this);f.imagesLoaded(function(){var h=f.data("layout");var n=JSON.stringify(h).split("");var q=[];for(var m=1;m<n.length+1;m++){q.push(m)}var v=[];for(m=0;m<q.length;++m){var o=0;for(p=0;p<m+1;++p){var r=parseInt(n[p],10);o+=r}var g=parseInt(n[m],10);v[m]=Array(q[m],g,o)}for(var m=0;m<q.length;m++){var j;if(v[m-1]===undefined){j=0}else{j=v[m-1][2]}f.find(c.photoWrap).slice(j,v[m][2]).addClass("count-"+v[m][1]).wrapAll('<div class="row clearit" />')}a(this).find(".row").css("margin-bottom",c.gutter);a(this).find(c.photoWrap+":not(:first-child) "+c.photo+" img").css("margin-left",c.gutter);Array.min=function(i){return Math.min.apply(Math,i)};function k(i){i.find(".row").each(function(){var z=a(this);var x=z.find(c.photoWrap).length;if(x>0){var w=z.find(c.photo+" img").map(function(){return a(this).height()}).get();var y=Array.min(w);z.height(y).find(c.photo).height(y)}})}k(f);a(window).resize(function(){k(f)});if(c.exif&&c.captions){f.find(c.photoWrap).each(function(){var D=a(this).find("img");var w;var x;if(D.hasClass("exif-yes")){var C=D.data("camera")||"-";var y=D.data("iso")||"-";var z=D.data("aperture")||"-";var i=D.data("exposure")||"-";var A=D.data("focal")||"-";w='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+C+'</td></tr><tr><td><span class="label">ISO</span><br>'+y+'</td><td><span class="label">Aperture</span><br>'+z+'</td></tr><tr><td><span class="label">Exposure</span><br>'+i+'</td><td><span class="label">Focal Length</span><br>'+A+"</td></tr></table>"}else{w=""}if(D.hasClass("caption-yes")){var B=D.data("caption");x='<p class="pxu-caption">'+B+"</p>"}else{x=""}if(x!==""||w!==""){a(this).find(".info").append('<div class="pxu-data">'+x+w+'<span class="arrow-down"></span></div>');if(w===""){a(this).find(".pxu-data").addClass("caption-only")}a(this).find("span.info").css("display","block")}})}else{if(c.exif){f.find(c.photoWrap).each(function(){var A=a(this).find("img");if(A.hasClass("exif-yes")){var w=A.data("camera")||"-";var i=A.data("iso")||"-";var B=A.data("aperture")||"-";var z=A.data("exposure")||"-";var y=A.data("focal")||"-";var x='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+w+'</td></tr><tr><td><span class="label">ISO</span><br>'+i+'</td><td><span class="label">Aperture</span><br>'+B+'</td></tr><tr><td><span class="label">Exposure</span><br>'+z+'</td><td><span class="label">Focal Length</span><br>'+y+'</td></tr></table><span class="arrow-down"></span>';a(this).find(".info").append('<div class="pxu-data">'+x+"</div>");a(this).find("span.info").css("display","block")}})}else{if(c.captions){f.find(c.photoWrap).each(function(){var i=a(this).find("img");if(i.hasClass("caption-yes")){var w=i.data("caption");var x='<p class="pxu-caption" style="margin:0;">'+w+"</p>";a(this).find(".info").append('<div class="pxu-data caption-only">'+x+'<span class="arrow-down"></span></div>');a(this).find("span.info").css("display","block")}})}}}if(c.highRes){f.find(c.photoWrap).each(function(){var i=a(this).find(".photo img");var w=i.data("highres");i.attr("src",w)})}if(c.rounded=="corners"){var u=f.find(".row"),l=f.find(".row").size(),t=(f.find(".row").size())-1;if(l==1){u.find(c.photoWrap+":first-child "+c.photo).css({borderRadius:c.borderRadius+" 0 0 "+c.borderRadius});u.find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 "+c.borderRadius+" "+c.borderRadius+" 0"})}else{for(var s=0;s<u.length;s++){if(s===0){count=u.eq(s).find(c.photo).size();if(count==1){u.eq(s).find(c.photo).css({borderRadius:c.borderRadius+" "+c.borderRadius+" 0 0"})}else{if(count==2||count==3){u.eq(s).find(c.photoWrap+":first-child "+c.photo).css({borderRadius:c.borderRadius+" 0 0 0"});u.eq(s).find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 "+c.borderRadius+" 0 0"})}}}if(s==t){count=u.eq(s).find(c.photo).size();if(count==1){u.eq(s).find(c.photo).css({borderRadius:"0 0 "+c.borderRadius+" "+c.borderRadius})}else{if(count==2||count==3){u.eq(s).find(c.photoWrap+":first-child "+c.photo).css({borderRadius:"0 0 0 "+c.borderRadius});u.eq(s).find(c.photoWrap+":last-child "+c.photo).css({borderRadius:"0 0 "+c.borderRadius+" 0"})}}}}}}if(c.rounded=="all"){f.find(c.photo).css({borderRadius:c.borderRadius})}if(!c.rounded){f.find(c.photo).css({borderRadius:0})}f.addClass("processed");if(typeof e=="function"){e.call(this)}});a(c.photoWrap).on("mouseenter",function(){a(this).find(".icons").css("visibility","visible")}).on("mouseleave",function(){a(this).find(".icons").css("visibility","hidden")});a("span.info").on("mouseenter",function(){var g=a(this);var h=g.children(".pxu-data");h.css("display","block").stop(true,false).animate({opacity:1},200)});a("span.info").on("mouseleave",function(){var g=a(this);var h=g.children(".pxu-data");h.stop(true,false).animate({opacity:0},200,function(){a(this).css("display","none")})})})}})(jQuery);