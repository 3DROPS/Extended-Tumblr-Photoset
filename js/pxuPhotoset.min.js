/*
    --------------------------------
    PXU Photoset Extended
    --------------------------------
    + https://github.com/PixelUnion/Extended-Tumblr-Photoset
    + Version 1.2.0
    + Copyright 2012 Pixel Union
    + Licensed under the MIT license    
*/

(function(a){a.fn.pxuPhotoset=function(b,c){var d={highRes:true,rounded:"corners",borderRadius:"5px",exif:true,captions:true,gutter:"10px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".photo"};var b=a.extend(d,b);return this.each(function(){var d=a(this);d.imagesLoaded(function(){function m(c){c.find(".count-1 img").each(function(){var b=a(this).height();a(this).parents(".row").height(b)});var d=c.find(".count-2 img").map(function(){return a(this).height()}).get();var e=Array.min(d);var f=c.find(".count-3 img").map(function(){return a(this).height()}).get();var g=Array.min(f);c.find(".count-2").parents(".row").css({height:e});c.find(".count-2").children(b.photo).css({height:e});c.find(".count-3").parents(".row").css({height:g});c.find(".count-3").children(b.photo).css({height:g})}var e=d.data("layout");var f=JSON.stringify(e).split("");var g=[];for(var h=1;h<f.length+1;h++){g.push(h)}var i=[];for(h=0;h<g.length;++h){var j=0;for(p=0;p<h+1;++p){increment=parseInt(f[p]);j+=increment}var k=parseInt(f[h]);i[h]=Array(g[h],k,j)}for(var h=0;h<g.length;h++){var l;if(i[h-1]===undefined){l=0}else{l=i[h-1][2]}d.find(b.photoWrap).slice(l,i[h][2]).addClass("count-"+i[h][1]).wrapAll('<div class="row clearit" />')}a(this).find(".row").css("margin-bottom",b.gutter);a(this).find(b.photoWrap+":not(:first-child) "+b.photo+" img").css("margin-left",b.gutter);Array.min=function(a){return Math.min.apply(Math,a)};m(d);a(window).resize(function(){m(d)});if(b.exif==true&&b.captions==true){d.find(b.photoWrap).each(function(){var b=a(this).find("img");var c;var d;if(b.hasClass("exif-yes")){var e=b.data("camera")||"-";exifISO=b.data("iso")||"-";exifAperture=b.data("aperture")||"-";exifExposure=b.data("exposure")||"-";exifFocal=b.data("focal")||"-";c='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+e+'</td></tr><tr><td><span class="label">ISO</span><br>'+exifISO+'</td><td><span class="label">Aperture</span><br>'+exifAperture+'</td></tr><tr><td><span class="label">Exposure</span><br>'+exifExposure+'</td><td><span class="label">Focal Length</span><br>'+exifFocal+"</td></tr></table>"}else{c=""}if(b.hasClass("caption-yes")){var f=b.data("caption");d='<p class="pxu-caption">'+f+"</p>"}else{d=""}if(d!=""||c!=""){a(this).find(".info").append('<div class="pxu-data">'+d+c+'<span class="arrow-down"></span></div>');if(c==""){a(this).find(".pxu-data").addClass("caption-only")}a(this).find("span.info").css("display","block")}})}else if(b.exif==true){d.find(b.photoWrap).each(function(){var b=a(this).find("img");if(b.hasClass("exif-yes")){var c=b.data("camera")||"-";exifISO=b.data("iso")||"-";exifAperture=b.data("aperture")||"-";exifExposure=b.data("exposure")||"-";exifFocal=b.data("focal")||"-";var d='<table class="exif"><tr><td colspan="2"><span class="label">Camera</span><br>'+c+'</td></tr><tr><td><span class="label">ISO</span><br>'+exifISO+'</td><td><span class="label">Aperture</span><br>'+exifAperture+'</td></tr><tr><td><span class="label">Exposure</span><br>'+exifExposure+'</td><td><span class="label">Focal Length</span><br>'+exifFocal+'</td></tr></table><span class="arrow-down"></span>';a(this).find(".info").append('<div class="pxu-data">'+d+"</div>");a(this).find("span.info").css("display","block")}})}else if(b.captions==true){d.find(b.photoWrap).each(function(){var b=a(this).find("img");if(b.hasClass("caption-yes")){var c=b.data("caption");var d='<p class="pxu-caption" style="margin:0;">'+c+"</p>";a(this).find(".info").append('<div class="pxu-data caption-only">'+d+'<span class="arrow-down"></span></div>');a(this).find("span.info").css("display","block")}})}if(b.highRes==true){d.find(b.photoWrap).each(function(){var b=a(this).find(".photo img");bigOne=b.data("highres");b.attr("src",bigOne)})}if(b.rounded=="corners"){var n=d.find(".row"),g=d.find(".row").size(),o=d.find(".row").size()-1;if(g==1){n.find(b.photoWrap+":first-child "+b.photo).css({borderRadius:b.borderRadius+" 0 0 "+b.borderRadius});n.find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 "+b.borderRadius+" "+b.borderRadius+" 0"})}else{for(var h=0;h<n.length;h++){if(h==0){count=n.eq(h).find(b.photo).size();if(count==1){n.eq(h).find(b.photo).css({borderRadius:b.borderRadius+" "+b.borderRadius+" 0 0"})}else if(count==2||count==3){n.eq(h).find(b.photoWrap+":first-child "+b.photo).css({borderRadius:b.borderRadius+" 0 0 0"});n.eq(h).find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 "+b.borderRadius+" 0 0"})}}if(h==o){count=n.eq(h).find(b.photo).size();if(count==1){n.eq(h).find(b.photo).css({borderRadius:"0 0 "+b.borderRadius+" "+b.borderRadius})}else if(count==2||count==3){n.eq(h).find(b.photoWrap+":first-child "+b.photo).css({borderRadius:"0 0 0 "+b.borderRadius});n.eq(h).find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 0 "+b.borderRadius+" 0"})}}}}}if(b.rounded=="all"){d.find(b.photo).css({borderRadius:b.borderRadius})}if(b.rounded==false){d.find(b.photo).css({borderRadius:0})}d.addClass("processed");if(typeof c=="function"){c.call(this)}});a(b.photoWrap).live("mouseenter",function(){a(this).find(".icons").css("visibility","visible")}).live("mouseleave",function(){a(this).find(".icons").css("visibility","hidden")});a("span.info").live("mouseenter",function(){var b=a(this);exifData=b.children(".pxu-data");exifData.css("display","block").stop(true,false).animate({opacity:1},200)});a("span.info").live("mouseleave",function(){var b=a(this);exifData=b.children(".pxu-data");exifData.stop(true,false).animate({opacity:0},200,function(){a(this).css("display","none")})})})}})(jQuery);