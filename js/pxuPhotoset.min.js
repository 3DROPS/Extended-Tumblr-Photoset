/*
    --------------------------------
    PXU Photoset Extended
    --------------------------------
    + https://github.com/PixelUnion/Extended-Tumblr-Photoset
    + Version 1.0.3
    + Copyright 2012 Pixel Union
    + Licensed under the MIT license    
*/

(function(a){a.fn.pxuPhotoset=function(b,c){var d={highRes:true,rounded:"corners",borderRadius:"5px",exif:true,gutter:"10px",photoset:".photo-slideshow",photoWrap:".photo-data",photo:".photo"};var b=a.extend(d,b);return this.each(function(){var d=a(this);d.imagesLoaded(function(){var e=d.data("layout");var f=JSON.stringify(e).split("");var g=[];for(var h=1;h<f.length+1;h++){g.push(h)}var i=[];for(h=0;h<g.length;++h){var j=0;for(p=0;p<h+1;++p){increment=parseInt(f[p]);j+=increment}var k=parseInt(f[h]);i[h]=Array(g[h],k,j)}for(var h=0;h<g.length;h++){var l;if(i[h-1]===undefined){l=0}else{l=i[h-1][2]}d.find(b.photoWrap).slice(l,i[h][2]).addClass("count-"+i[h][1]).wrapAll('<div class="row clearit" />')}a(this).find(".row").css("margin-bottom",b.gutter);a(this).find(b.photoWrap+":not(:first-child) "+b.photo+" img").css("margin-left",b.gutter);Array.min=function(a){return Math.min.apply(Math,a)};d.find(".count-1 img").each(function(){var b=a(this).height();a(this).parents(".row").height(b)});var m=a(this).find(".count-2 img").map(function(){return a(this).height();}).get();var n=Array.min(m);var o=a(this).find(".count-3 img").map(function(){return a(this).height();}).get();var q=Array.min(o);d.find(".count-2").parents(".row").css({height:n});d.find(".count-2").children(b.photo).css({height:n});d.find(".count-3").parents(".row").css({height:q});d.find(".count-3").children(b.photo).css({height:q});if(b.exif==true){d.find(b.photoWrap).each(function(){var b=a(this).find("img");exifCamera=b.data("camera")||"-";exifISO=b.data("iso")||"-";exifAperture=b.data("aperture")||"-";exifExposure=b.data("exposure")||"-";exifFocal=b.data("focal")||"-";a(this).find(".info").append('<div class="exif"><table><tr><td colspan="2"><span class="label">Camera</span><br>'+exifCamera+'</td></tr><tr><td><span class="label">ISO</span><br>'+exifISO+'</td><td><span class="label">Aperture</span><br>'+exifAperture+'</td></tr><tr><td><span class="label">Exposure</span><br>'+exifExposure+'</td><td><span class="label">Focal Length</span><br>'+exifFocal+'</td></tr></table><span class="arrow-down"></span></div>');d.find("span.info").css("display","block")})}if(b.highRes==true){d.find(b.photoWrap).each(function(){var b=a(this).find("img");bigOne=b.data("highres");b.attr("src",bigOne)})}if(b.rounded=="corners"){var r=d.find(".row"),g=d.find(".row").size(),s=d.find(".row").size()-1;if(g==1){r.find(b.photoWrap+":first-child "+b.photo).css({borderRadius:b.borderRadius+" 0 0 "+b.borderRadius});r.find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 "+b.borderRadius+" "+b.borderRadius+" 0"})}else{for(var h=0;h<r.length;h++){if(h==0){count=r.eq(h).find(b.photo).size();if(count==1){r.eq(h).find(b.photo).css({borderRadius:b.borderRadius+" "+b.borderRadius+" 0 0"})}else if(count==2||count==3){r.eq(h).find(b.photoWrap+":first-child "+b.photo).css({borderRadius:b.borderRadius+" 0 0 0"});r.eq(h).find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 "+b.borderRadius+" 0 0"})}}if(h==s){count=r.eq(h).find(b.photo).size();if(count==1){r.eq(h).find(b.photo).css({borderRadius:"0 0 "+b.borderRadius+" "+b.borderRadius})}else if(count==2||count==3){r.eq(h).find(b.photoWrap+":first-child "+b.photo).css({borderRadius:"0 0 0 "+b.borderRadius});r.eq(h).find(b.photoWrap+":last-child "+b.photo).css({borderRadius:"0 0 "+b.borderRadius+" 0"})}}}}}if(b.rounded=="all"){d.find(b.photo).css({borderRadius:b.borderRadius})}if(b.rounded==false){d.find(b.photo).css({borderRadius:0})}d.addClass("processed");if(typeof c=="function"){c.call(this)}});a(b.photoWrap).live("mouseenter",function(){a(this).find(".icons").css("visibility","visible")}).live("mouseleave",function(){a(this).find(".icons").css("visibility","hidden")});a("span.info").live("mouseenter",function(){var b=a(this);exifData=b.children(".exif");exifData.css("display","block").stop(true,false).animate({opacity:1},200)});a("span.info").live("mouseleave",function(){var b=a(this);exifData=b.children(".exif");exifData.stop(true,false).animate({opacity:0},200,function(){a(this).css("display","none")})})})}})(jQuery);